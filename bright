#!/bin/bash

# Brightness control script for multiple devices

# Define devices
DEVICES=("nvidia_0" "nvidia_wmi_ec_backlight" "amdgpu_bl1")

# Check if percentage is provided
if [ $# -ne 1 ]; then
    echo "Error: Please provide a brightness percentage (1-100)"
    exit 1
fi

# Validate input is a number between 1-100
if ! [[ "$1" =~ ^[0-9]+$ ]] || [ "$1" -lt 1 ] || [ "$1" -gt 100 ]; then
    echo "Error: Brightness must be a percentage between 1-100"
    exit 1
fi

PERCENTAGE=$1
SUCCESS=0
FAILED=0

# Set brightness for each device
for DEVICE in "${DEVICES[@]}"; do
    brightnessctl -d "$DEVICE" set "$PERCENTAGE%" &>/dev/null
    STATUS=$?
    
    if [ $STATUS -eq 0 ]; then
        ((SUCCESS++))
    else
        ((FAILED++))
        echo "Failed to set brightness for $DEVICE"
    fi
done

# Report results
if [ $FAILED -eq 0 ]; then
    echo "Brightness set to $PERCENTAGE% on all devices"
else
    echo "Brightness set on $SUCCESS devices, failed on $FAILED devices"
fi

exit $FAILED